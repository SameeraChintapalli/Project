<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Public → Police Complaint Portal (Demo)</title>
  <style>
    :root{--accent:#0f766e;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial;line-height:1.4;margin:0;background:#f7faf9;color:#0f172a}
    header{background:linear-gradient(90deg,#06b6d4, #0ea5a4);color:white;padding:18px 22px}
    .container{max-width:1000px;margin:24px auto;padding:18px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .card{background:white;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.06);padding:16px}
    label{display:block;margin-bottom:6px;font-weight:600}
    input[type=text],input[type=email],textarea,select{width:100%;padding:10px;border:1px solid #e6e9ee;border-radius:8px;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    .row{display:flex;gap:12px}
    .row > *{flex:1}
    .muted{color:var(--muted);font-size:13px}
    .btn{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(15,118,110,0.12)}
    .small{font-size:13px;padding:8px 10px}
    .complaint-list{max-height:540px;overflow:auto}
    .complaint{border:1px solid #eef2f7;border-radius:8px;padding:10px;margin-bottom:10px}
    .meta{font-size:13px;color:var(--muted);margin-bottom:6px}
    .status{display:inline-block;padding:4px 8px;border-radius:999px;font-weight:700;font-size:12px}
    .status.open{background:#fef3c7;color:#92400e}
    .status.resolved{background:#d1fae5;color:#065f46}
    .actions{display:flex;gap:8px;margin-top:8px}
    .footer-note{font-size:12px;color:var(--muted);margin-top:8px}
    .login-panel{display:flex;flex-direction:column;gap:8px}
    .center{display:flex;align-items:center;justify-content:center}
    @media (max-width:980px){.grid{grid-template-columns:1fr;}.container{padding:12px}}
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <h1>Public → Police Complaint Portal (Demo)</h1>
      <div class="muted">Local demo — no server. Uses browser storage.</div>
    </div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Public complaint form -->
      <section class="card" aria-labelledby="form-title">
        <h2 id="form-title">File a Complaint</h2>
        <p class="muted">Fill the form. Your complaint will be saved locally in your browser (for demo/testing).</p>

        <form id="complaintForm" autocomplete="off">
          <div style="margin-top:12px">
            <label for="name">Full name</label>
            <input id="name" name="name" type="text" placeholder="e.g. Ravi Kumar" required />
          </div>

          <div style="margin-top:12px" class="row">
            <div>
              <label for="phone">Phone</label>
              <input id="phone" name="phone" type="text" placeholder="Mobile number" required />
            </div>
            <div>
              <label for="email">Email (optional)</label>
              <input id="email" name="email" type="email" placeholder="you@example.com" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label for="address">Address / Location</label>
            <input id="address" name="address" type="text" placeholder="Locality, city, landmark" />
          </div>

          <div style="margin-top:12px">
            <label for="type">Complaint Type</label>
            <select id="type" name="type">
              <option value="theft">Theft</option>
              <option value="fraud">Fraud / Scams</option>
              <option value="assault">Assault / Threats</option>
              <option value="missing">Missing person</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div style="margin-top:12px">
            <label for="desc">Complaint description</label>
            <textarea id="desc" name="desc" placeholder="Describe what happened, when, who was involved, witnesses, etc." required></textarea>
          </div>

          <div style="margin-top:12px">
            <label for="file">Attach photo / evidence (optional)</label>
            <input id="file" type="file" accept="image/*" />
            <div id="preview" class="muted"></div>
          </div>

          <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
            <button class="btn" type="submit">Submit Complaint</button>
            <button type="button" class="btn ghost" id="clearAll">Clear all complaints</button>
          </div>

          <p class="footer-note">Important: This is a demo app that stores data locally in the browser. For real deployments you must use a secure backend, authentication, and end-to-end encryption.</p>
        </form>
      </section>

      <!-- Police / Admin panel -->
      <aside class="card">
        <h2>Police / Officer Panel</h2>
        <div id="authArea" class="login-panel">
          <label for="officerPass">Officer password</label>
          <input id="officerPass" type="password" placeholder="Enter officer password" />
          <div style="display:flex;gap:8px">
            <button class="btn small" id="loginBtn">Log in</button>
            <button class="btn ghost small" id="logoutBtn" style="display:none">Log out</button>
          </div>
          <div id="authMsg" class="muted"></div>
        </div>

        <hr style="margin:12px 0" />

        <div id="adminContent" style="display:none">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div class="muted">Complaints</div>
            <div><button id="refreshBtn" class="btn ghost small">Refresh</button></div>
          </div>

          <div class="complaint-list" id="complaints"></div>
        </div>

      </aside>
    </div>
  </main>

  <script>
    // Demo officer password (DO NOT use this in production). Change if needed.
    const OFFICER_PASSWORD = 'police1234';
    const STORAGE_KEY = 'demo_complaints_v1';

    // util to read complaints from localStorage
    function loadComplaints(){
      try{const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):[];}catch(e){console.error(e); return []}
    }
    function saveComplaints(arr){localStorage.setItem(STORAGE_KEY, JSON.stringify(arr))}

    // form handling
    const form = document.getElementById('complaintForm');
    const fileInput = document.getElementById('file');
    const preview = document.getElementById('preview');

    let latestFileData = null;
    fileInput.addEventListener('change', e=>{
      const f = e.target.files && e.target.files[0];
      if(!f){ latestFileData = null; preview.textContent = ''; return; }
      if(!f.type.startsWith('image/')){ preview.textContent = 'Only images allowed'; latestFileData=null; return; }
      const reader = new FileReader();
      reader.onload = ()=>{ latestFileData = reader.result; preview.textContent = f.name + ' — ready'; }
      reader.readAsDataURL(f);
    });

    form.addEventListener('submit', e=>{
      e.preventDefault();
      const data = {
        id: 'c_' + Date.now() + '_' + Math.random().toString(36).slice(2,7),
        name: form.name.value.trim(),
        phone: form.phone.value.trim(),
        email: form.email.value.trim(),
        address: form.address.value.trim(),
        type: form.type.value,
        desc: form.desc.value.trim(),
        file: latestFileData || null,
        createdAt: new Date().toISOString(),
        status: 'open'
      };
      const arr = loadComplaints();
      arr.unshift(data);
      saveComplaints(arr);
      alert('Complaint submitted — Thank you. (Demo saves locally)');
      form.reset(); preview.textContent=''; latestFileData = null;
    });

    // admin auth
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const authMsg = document.getElementById('authMsg');
    const adminContent = document.getElementById('adminContent');

    function isLoggedIn(){return sessionStorage.getItem('demo_officer_logged') === '1'}
    function setLoggedIn(val){ if(val) sessionStorage.setItem('demo_officer_logged','1'); else sessionStorage.removeItem('demo_officer_logged') }

    function renderAuth(){
      if(isLoggedIn()){
        adminContent.style.display='block'; document.getElementById('logoutBtn').style.display='inline-block'; document.getElementById('loginBtn').style.display='none'; authMsg.textContent='Logged in as officer (demo)';
        document.getElementById('officerPass').style.display='none';
        renderComplaints();
      } else {
        adminContent.style.display='none'; document.getElementById('logoutBtn').style.display='none'; document.getElementById('loginBtn').style.display='inline-block'; authMsg.textContent=''; document.getElementById('officerPass').style.display='block';
      }
    }

    loginBtn.addEventListener('click', ()=>{
      const p = document.getElementById('officerPass').value;
      if(p === OFFICER_PASSWORD){ setLoggedIn(true); renderAuth(); }
      else{ authMsg.textContent = 'Incorrect password'; }
    });
    logoutBtn.addEventListener('click', ()=>{ setLoggedIn(false); renderAuth(); });

    // complaint list rendering for officer
    function renderComplaints(){
      const container = document.getElementById('complaints'); container.innerHTML='';
      const arr = loadComplaints();
      if(arr.length===0){ container.innerHTML = '<div class="muted">No complaints yet.</div>'; return; }
      arr.forEach(item=>{
        const div = document.createElement('div'); div.className='complaint';
        const meta = document.createElement('div'); meta.className='meta';
        meta.innerHTML = `<strong>${escapeHtml(item.name)}</strong> • ${escapeHtml(item.type)} • ${new Date(item.createdAt).toLocaleString()}`;
        const status = document.createElement('span'); status.className = 'status ' + (item.status==='open' ? 'open' : 'resolved'); status.textContent = item.status.toUpperCase();
        meta.appendChild(document.createTextNode(' ')); meta.appendChild(status);
        const desc = document.createElement('div'); desc.textContent = item.desc; desc.style.marginTop='8px';
        const contact = document.createElement('div'); contact.className='muted'; contact.textContent = `Phone: ${item.phone || '-'} • Email: ${item.email || '-'}`;

        div.appendChild(meta);
        div.appendChild(desc);
        if(item.file){
          const img = document.createElement('img'); img.src = item.file; img.alt = 'attachment'; img.style.maxWidth='100%'; img.style.marginTop='8px'; img.style.borderRadius='6px'; div.appendChild(img);
        }
        div.appendChild(contact);

        const actions = document.createElement('div'); actions.className='actions';
        const resolveBtn = document.createElement('button'); resolveBtn.className='btn small'; resolveBtn.textContent = item.status==='open'? 'Mark Resolved' : 'Reopen';
        resolveBtn.addEventListener('click', ()=>{ toggleStatus(item.id); });
        const delBtn = document.createElement('button'); delBtn.className='btn ghost small'; delBtn.textContent='Delete'; delBtn.addEventListener('click', ()=>{ if(confirm('Delete this complaint?')){ deleteComplaint(item.id); }});
        actions.appendChild(resolveBtn); actions.appendChild(delBtn);
        div.appendChild(actions);

        container.appendChild(div);
      });
    }

    function toggleStatus(id){
      const arr = loadComplaints();
      const i = arr.findIndex(c=>c.id===id); if(i===-1) return;
      arr[i].status = arr[i].status === 'open' ? 'resolved' : 'open';
      saveComplaints(arr); renderComplaints();
    }
    function deleteComplaint(id){
      let arr = loadComplaints(); arr = arr.filter(c=>c.id!==id); saveComplaints(arr); renderComplaints();
    }

    // helper escape to avoid accidental HTML injection when rendering text
    function escapeHtml(s){ if(!s) return ''; return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }

    // clear all complaints (dangerous) — accessible from UI
    document.getElementById('clearAll').addEventListener('click', ()=>{
      if(confirm('This will permanently remove all complaints stored in this browser. Continue?')){ localStorage.removeItem(STORAGE_KEY); alert('All complaints removed (local demo).'); }
    });

    document.getElementById('refreshBtn').addEventListener('click', renderComplaints);

    // initial render
    renderAuth();

  </script>

  <!--
    Notes for deployers:
    - This is a frontend-only demo that stores complaints in localStorage. For production:
      * Implement server-side storage (database), authentication (OAuth / SSO), access control (officer roles), and secure file uploads.
      * Use HTTPS, input validation on server, rate-limiting, and audit logs.
      * Consider privacy and legal requirements for handling reports.
  -->
</body>
</html>
